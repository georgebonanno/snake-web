<html>
<body>

	<canvas id="snakeGameCanvas" width="800" height="800" style="border:1px solid #000000;">

	</canvas>
	<script type="text/javascript">

		class Snake {

			constructor(initx,inity) {
				this.posx = initx;
				this.posy = inity;
				this.direction='S';
			}

			move() {
				ctx.clearRect(0,0,canvas.width,canvas.height);
				ctx.beginPath();
				ctx.moveTo(this.posx,this.posy);
				ctx.fillRect(randomPt.x,randomPt.y,5,5);

				var nposy=this.posy;
				var nposx=this.posx;

				switch (direction) {
					case 'N':
							nposy=this.posy-10;
							break;
					case 'S':
							nposy=this.posy+10;
							break;
					case 'E':
							nposx=this.posx-10;
							break;
					case 'W':
							nposx=this.posx+10;
							break;
					default:
							throw "undefined direction: "+direction;
				}
				ctx.lineTo(nposx,nposy);
				ctx.moveTo(nposx,nposy);
				console.log(`moving to ${this.posx},${this.posy} -> ${nposx},${nposy}`)
				this.posx=nposx;
				this.posy=nposy;
				
				ctx.stroke();
			}
		}

		function randomPoint(rangex,rangey) {
			return {
				x: Math.floor(Math.random()*rangex),
				y: Math.floor(Math.random()*rangey)
			};
		}
		
		

		var canvas=document.getElementById('snakeGameCanvas');
		var ctx=canvas.getContext("2d");
		ctx.lineWidth = 5;


		var randomPt=randomPoint(canvas.width,canvas.height);


		direction='S'

		var snake = new Snake(canvas.width/2,canvas.height/2);

		console.log("adding listener....");
		document.addEventListener("keydown",event => {
			console.log(`key down: ${event.keyCode}`);
			switch (event.keyCode) {
				case 38:
					if (direction != 'S') {
						direction = 'N';
					}	
					break;
				case 39:
					if (direction != 'E') {
						direction = 'W';
					}
					break;
				case 40:
					if (direction != 'N') {
						direction = 'S';
					}
					break;
				case 37:
					if (direction != 'W') {
						direction = 'E';
					}
					break;
				default:
					break;
			};
			console.log(`new direction: ${direction}`);
		})

		//console.log(`posx: ${posx}`)
		setInterval(() => snake.move(direction),100);



	</script>
</body>
</html>